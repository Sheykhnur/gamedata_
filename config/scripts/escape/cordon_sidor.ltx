[logic]
active = mob_trader@wait 
on_trade = mob_trade@new
trade = misc\trade\trade_sidor.ltx

[mob_trader@lulz_start]
anim_global = chair_hack_idle
can_talk = false
tip_text = 
on_timer = 6000 |mob_trader@lulz_start_main

[mob_trader@lulz_start_main]
anim_global = trader_lulz_start
can_talk = false
tip_text = 
on_timer = 2800 | mob_trader@lulz

[mob_trader@lulz]
anim_global = trader_lulz1
can_talk = false
tip_text = 
on_info = {-esc_trader_radio_lulz} mob_trader@new_idle1
on_timer = 9000 | mob_trader@lulz2_start

[mob_trader@lulz2_start]
anim_global = trader_lulz2_start
can_talk = false
tip_text = 
on_timer = 500 | mob_trader@lulz2

[mob_trader@lulz2]
anim_global = trader_lulz2
can_talk = false
tip_text = 
on_info = {-esc_trader_radio_lulz} mob_trader@new_idle1
on_timer = 9000 | mob_trader@lulz

; ------------------------------------------------------------------------------------------------------
; СТАРТ
; ------------------------------------------------------------------------------------------------------
; Ждем немного

;Читает(ждет)
[mob_trader@wait]
anim_global = listen_idle
on_info = {-esc_hands_anim_start -ecs_trader_meet} %+esc_hands_anim_start =intro_start%
on_info2 = {=dist_to_actor_le(3) -esc_trader_intro_done} mob_trader@new_start_wait0 %+esc_actor_start_replic%
on_info3 = {+esc_trader_intro_done} mob_trader@new_idle1
can_talk = false
tip_text = 

;Читает - стол
[mob_trader@new_start_wait0]
anim_global = listen_to_desk
can_talk = false
tip_text =
on_signal = animation_end | mob_trader@new_start_wait1

;Переходим
[mob_trader@new_start_wait1]
anim_global = desk_to_diagonal
on_signal = animation_end | mob_trader@new_start_wait2
can_talk = false
tip_text =

:Слушаем игрока
[mob_trader@new_start_wait2]
anim_global = diagonal_idle
on_info = {+esc_sid_replic} mob_trader@new_start_intro0 ;mob_trader@new_start_close
can_talk = false
tip_text = 

;Начальный диалог
[mob_trader@new_start_intro0]
anim_global = diagonal_talk
anim_head = normal
sound_phrase = trader_start
can_talk = false
tip_text =
on_signal = sound_phrase_end | mob_trader@new_start_close %+esc_sid_replic_said%

;Подвигаемся к нему
[mob_trader@new_start_close]
anim_global = diagonal_to_desk
on_signal = animation_end| mob_trader@new_start_intro1
can_talk = false
tip_text =

;ждем отыгрывание реплики эктора
[mob_trader@new_start_intro1]
anim_global = desk_wait
can_talk = false
tip_text =
on_info = {+esc_actor_start_replic2} mob_trader@new_start_intro2

;фраза "притормози, я тебя спас..."
[mob_trader@new_start_intro2]
anim_global = first_phrase ;intro_phrase ;test
anim_head	= first_phrase ;intro_phrase ;test
sound_phrase = trader_monolog1
on_signal = animation_end| mob_trader@new_start_intro3 %+esc_trader_met%
can_talk = false
tip_text =

; Ждем немного, включаем управление
[mob_trader@new_start_intro3]
anim_global = desk_idle
tip = tips_esc_trader_how_to_talk
on_info = {=talking} mob_trader@new_idle1 %+esc_trader_intro_done%
on_timer = 5000 | mob_trader@new_start_intro4


; Говорим вторую фразу (что стоишь? подходи)
[mob_trader@new_start_intro4]
anim_global = desk_talk
anim_head = normal
;sound_phrase = trader_come_here2
;on_signal = sound_phrase_end | mob_trader@new_idle1
on_info = {=talking} mob_trader@new_idle1 %+esc_trader_intro_done% ; обрывать фразу

;----------------------------------
;------------- Idle ---------------
;----------------------------------

;Основной idle (1) - за столом
[mob_trader@new_idle1]
anim_global = desk_idle
on_signal = animation_end| {~25} mob_trader@new_idle1_to_idle3, {~50} mob_trader@new_idle1_to_idle5, {~75} mob_trader@new_idle1_to_idle2, mob_trader@new_idle1_to_idle1
on_info = {=talking} mob_trader@new_idle1_to_idle3
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12 | mob_trader@new_wait
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info3 = {+esc_trader_dialog2 -esc_trader_told_dialog2} mob_trader@dialog2 %+esc_trader_told_dialog2%
on_info4 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

[mob_trader@minimap]
anim_global = intro_phrase
anim_head = intro_phrase
sound_phrase = trader_minimap
can_talk = false
tip_text =
on_info = {+esc_sid_minimap_tut_stop} mob_trader@new_idle1

; Idle (2) - по диагонали
[mob_trader@new_idle2]
anim_global = diagonal_idle
on_signal = animation_end| {~25} mob_trader@new_idle2_to_idle3, {~50} mob_trader@new_idle2_to_idle4, {~75} mob_trader@new_idle2_to_idle1, mob_trader@new_idle2_to_idle2
on_info = {=talking} mob_trader@new_idle2_to_idle3
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12 | mob_trader@new_wait
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info3 = {+esc_trader_dialog2 -esc_trader_told_dialog2} mob_trader@dialog2 %+esc_trader_told_dialog2%
on_info4 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Idle (3) - откинувшись на спинку
[mob_trader@new_idle3]
anim_global = chair_hack_idle
on_signal = animation_end| {~30} mob_trader@new_idle3_to_idle2, {~70} mob_trader@new_idle3_to_idle1, mob_trader@new_idle3_to_idle3
on_info = {=talking} mob_trader@new_talking
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12 | mob_trader@new_wait
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info3 = {+esc_trader_dialog2 -esc_trader_told_dialog2} mob_trader@dialog2 %+esc_trader_told_dialog2%
on_info4 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Idle (4) - за компьютером
[mob_trader@new_idle4]
anim_global = desk_idle
on_signal = animation_end| {~40} mob_trader@new_idle4_to_idle2, mob_trader@new_idle4_to_idle4
on_info = {=talking} mob_trader@new_idle4_to_idle2
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12 | mob_trader@new_wait
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info3 = {+esc_trader_dialog2 -esc_trader_told_dialog2} mob_trader@dialog2 %+esc_trader_told_dialog2%
on_info4 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Idle (5) - читает
[mob_trader@new_idle5]
anim_global = listen_idle
on_signal = animation_end| {~45} mob_trader@new_idle5_to_idle1, mob_trader@new_idle5_to_idle5
on_info = {=talking} mob_trader@new_idle5_to_idle1
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12 | mob_trader@new_wait
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info3 = {+esc_trader_dialog2 -esc_trader_told_dialog2} mob_trader@dialog2 %+esc_trader_told_dialog2%
on_info4 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%


;******new dialog 2************

[mob_trader@dialog2]
anim_global = diagonal_talk
anim_head	= normal
sound_phrase = trader_monolog2
on_signal = sound_phrase_end| mob_trader@new_idle1 %+esc_talk_to_sid +esc_dialog2_finished%
can_talk = false
tip_text =


;----------------------------------
;--------   Автопереходы   --------
;----------------------------------

; Стол - стол (промежуточная)
[mob_trader@new_idle1_to_idle1]
anim_global = desk_idle
on_signal = animation_end| mob_trader@new_idle1
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Диагональ - диагональ (промежуточная)
[mob_trader@new_idle2_to_idle2]
anim_global = diagonal_idle
on_signal = animation_end| mob_trader@new_idle2
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Спинка - спинка (промежуточная)
[mob_trader@new_idle3_to_idle3]
anim_global = chair_hack_idle
on_signal = animation_end| mob_trader@new_idle3
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Компьютер - компьютер (промежуточная)
[mob_trader@new_idle4_to_idle4]
anim_global = desk_idle
on_signal = animation_end| mob_trader@new_idle4
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Читает - читает (промежуточная)
[mob_trader@new_idle5_to_idle5]
anim_global = listen_idle
on_signal = animation_end| mob_trader@new_idle5
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

;----------------------------------
;----- Переходы  между idle-ми ----
;----------------------------------

; Диагональ - компьютер
[mob_trader@new_idle2_to_idle4]
anim_global = diagonal_to_desk
on_signal = animation_end| mob_trader@new_idle4
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Компьютер - диагональ
[mob_trader@new_idle4_to_idle2]
anim_global = desk_to_diagonal
on_signal = animation_end| mob_trader@new_idle2
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Диагональ - спинка
[mob_trader@new_idle2_to_idle3]
anim_global = diagonal_to_chair_hack
on_signal = animation_end| {=talking} mob_trader@new_talking, mob_trader@new_idle3
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Спинка - диагональ
[mob_trader@new_idle3_to_idle2]
anim_global = chair_hack_to_diagonal
on_signal = animation_end| mob_trader@new_idle2
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Стол - спинка
[mob_trader@new_idle1_to_idle3]
anim_global = desk_to_chair_hack
on_signal = animation_end|{=talking} mob_trader@new_talking, mob_trader@new_idle3
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Спинка - стол
[mob_trader@new_idle3_to_idle1]
anim_global = chair_hack_to_desk
on_signal = animation_end| mob_trader@new_idle1
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Стол - диагональ
[mob_trader@new_idle1_to_idle2]
anim_global = desk_to_diagonal
on_signal = animation_end| mob_trader@new_idle2
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Диагональ - стол
[mob_trader@new_idle2_to_idle1]
anim_global = diagonal_to_desk
on_signal = animation_end| mob_trader@new_idle1
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Стол - читает
[mob_trader@new_idle1_to_idle5]
anim_global = desk_to_listen
on_signal = animation_end| mob_trader@new_idle5
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

; Читает - стол
[mob_trader@new_idle5_to_idle1]
anim_global = listen_to_desk
on_signal = animation_end| mob_trader@new_idle1
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
on_info2 = {+esc_sid_minimap_tut -esc_sid_mapped}  mob_trader@minimap %+esc_sid_mapped%

;--------------------------------------
;------------- Разговор ---------------
;--------------------------------------

[mob_trader@new_talking]
anim_global = chair_hack_talk
anim_head = normal
on_info = {!talking} mob_trader@new_idle3
on_info2 = {+esc_trader_radio_lulz} mob_trader@lulz_start
;--------------------------------------
;------------ Торговля ----------------
;--------------------------------------

[mob_trade@new]
anim_global = chair_hack_idle
on_info = {=trading =trade_exchanged =see_actor} mob_trader@new_trade_exchanged
on_info2 = {!trading =trade_exchanged =see_actor} mob_trader@new_trade_good
on_info3 = {!trading !trade_exchanged =see_actor} mob_trader@new_trade_bad
on_info4 = {+esc_trader_radio_lulz} mob_trader@lulz_start

[mob_trader@new_trade_bad]
;anim_global = diagonal_talk
anim_global = chair_hack_idle
anim_head = angry
sound_phrase = trader_bad_trade
on_signal = sound_phrase_end | mob_trader@new_idle2
on_actor_dist_ge_nvis = 12 | mob_trader@new_wait
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start

[mob_trader@new_trade_exchanged]
;anim_global = diagonal_talk
anim_global = chair_hack_idle
anim_head = normal
sound_phrase = trader_exchanged
on_signal = sound_phrase_end | mob_trader@new_idle2
on_actor_dist_ge_nvis = 12 | mob_trader@new_wait
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start

[mob_trader@new_trade_good]
;anim_global = diagonal_talk
anim_global = chair_hack_idle
anim_head = good
sound_phrase = trader_good_trade
on_signal = sound_phrase_end | mob_trader@new_idle2
on_actor_dist_ge_nvis = 12 | mob_trader@new_wait
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start

;-------------------------------------
;---------- Приветствия --------------
;-------------------------------------

[mob_trader@new_hello]
anim_global = hello
anim_head = normal
sound_phrase = trader_hello_what_have_you_got
on_signal = animation_end | mob_trader@new_idle2
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start

[mob_trader@new_bye]
on_actor_dist_ge_nvis = 12 |mob_trader@new_wait
anim_global = hello
anim_head = normal
sound_phrase = trader_bye
on_signal = animation_end | mob_trader@new_wait
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start

[mob_trader@new_wait]
anim_global = diagonal_idle_short
on_actor_dist_le_nvis = 3 | {-esc_trader_hello_played} mob_trader@new_hello %+esc_trader_hello_played%
on_actor_dist_ge_nvis = 5 | {-esc_trader_bye_played -esc_actor_in_room +esc_trader_hello_played} mob_trader@new_bye %+esc_trader_bye_played%
on_actor_dist_ge_nvis2 = 12    | %-esc_trader_hello_played -esc_trader_bye_played%
on_info = {+esc_trader_radio_lulz} mob_trader@lulz_start
